<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>Xiaolan</title>
	<link rel="Shortcut icon" href="favicon.ico" loading="lazy">
	<!-- 预加载关键CSS -->
	<link rel="preload" href="css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
	<noscript><link rel="stylesheet" href="css/bootstrap.min.css"></noscript>
	<link rel="preload" href="css/index.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
	<noscript><link rel="stylesheet" href="css/index.css"></noscript>
	<link rel="preload" href="css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
	<noscript><link rel="stylesheet" href="css/all.min.css"></noscript>
	<link rel="stylesheet" type="text/css" href="css/search-form.css" media="print" onload="this.media='all'">
	
	<!-- 异步加载JS -->
	<script src="js/jquery-3.5.1.min.js" defer></script>
	<script src="performance-config.js" defer></script>
</head>

<body style="overflow-y: hidden">
    <!-- 网络延迟检测浮动按钮 -->
    <button id="latencyBtn" class="fixed-top right-3 top-3 z-50 bg-primary text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg" title="查看网络延迟">
        <i class="fas fa-wifi"></i>
    </button>
    
    <!-- 网络延迟检测面板 -->
    <div id="latencyPanel" class="fixed top-0 right-0 w-80 h-full bg-white shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out z-40 p-4">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-bold">网络延迟检测</h3>
            <button id="closeLatencyPanel" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <div class="bg-gray-100 p-3 rounded-lg">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium">服务器延迟</span>
                    <span id="serverLatency" class="text-sm font-bold text-gray-500">检测中...</span>
                </div>
                <div class="w-full bg-gray-300 rounded-full h-1.5">
                    <div id="serverLatencyBar" class="bg-blue-500 h-1.5 rounded-full" style="width: 0%"></div>
                </div>
                <div class="mt-2 text-xs text-gray-500">
                    <span id="serverStatus">状态: 连接中</span>
                </div>
            </div>
            
            <div class="bg-gray-100 p-3 rounded-lg">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium">Google延迟</span>
                    <span id="googleLatency" class="text-sm font-bold text-gray-500">检测中...</span>
                </div>
                <div class="w-full bg-gray-300 rounded-full h-1.5">
                    <div id="googleLatencyBar" class="bg-green-500 h-1.5 rounded-full" style="width: 0%"></div>
                </div>
                <div class="mt-2 text-xs text-gray-500">
                    <span id="googleStatus">状态: 连接中</span>
                </div>
            </div>
            
            <div class="text-xs text-gray-500 mt-6">
                <p>• 延迟值越小，连接速度越快</p>
                <p>• 绿色: 优秀 (<100ms)</p>
                <p>• 黄色: 良好 (100-200ms)</p>
                <p>• 橙色: 一般 (200-500ms)</p>
                <p>• 红色: 较差 (>500ms)</p>
            </div>
        </div>
        
        <button id="refreshLatency" class="mt-6 w-full bg-primary text-white py-2 rounded-lg text-sm font-medium">
            <i class="fas fa-sync-alt mr-2"></i>刷新检测
        </button>
    </div>
	<!-- 管理功能已移除 -->
	<div class="z-2 d-flex flex-column mx-auto">
		<div class="d-flex flex-column justify-content-end" style="height: 40%;">
			<div class="mx-auto shadow mt-3 rounded-3"><img id="indexing" width="250" src="img/login.png" class="p-1">
			</div>
			<div class="mx-auto mt-5 pt-5">
				<form onsubmit="submitFn(this, event);">
					<div class="search-wrapper">
						<div class="input-holder">
							<input type="text" id="txt" class="search-input" placeholder="Type to search"
								onkeyup="searchToggle(this, event);" />
							<button class="search-icon" onclick="searchToggle(this, event);"><span></span></button>
						</div>
						<span class="close" onclick="searchToggle(this, event);"></span>
						<div class="result-container"></div>
					</div>
					<div id="search_ajx">
						<ul id="list" style="display:none;"></ul>
					</div>
				</form>
				<script type="text/javascript" src="js/search_ajx.js"></script>
			</div>
		</div>
		<div class="d-flex flex-column" style="height: 60%;">
			<nav class="p-2 mx-auto mt-5 pt-5">
				<div class="nav nav-tabs shadow rounded-2" id="nav-tabs-container">
					<!-- More链接将由JavaScript动态添加 -->
				</div>
			</nav>
			<div class="kuaijie mx-auto mt-3" id="nav-content-container"></div>
		</div>
		<div class="fixed-bottom mx-1">
			<div class="container-fluid">
				<div class="float-start fw-light"><span id="jinrishici-sentence">正在加载今日诗词....</span></div>
				<div class="float-end">
					<span class="badge text-black-50">
						<a href="test/index.html" rel="nofollow" target="_blank">Ts</a> •
						<a href="https://xiaolanqqai-sturdy-journey-97xqj446r6wfpw6v.github.dev/" rel="nofollow" target="_blank">Dev</a> •
						<a id="uptime1" href="index/Develop.html">加载中...</a>
					</span>
					<span id="state1" class="badge text-bg-success">加载中...</span>
					<a><div class="spinner-grow spinner-grow-sm text-info" role="status"></div></a>
				</div>
			</div>
		</div>
	</div>
	<script>
	// 异步加载关键JS
	function loadScript(src, callback) {
		var script = document.createElement('script');
		script.src = src;
		script.onload = callback;
		document.head.appendChild(script);
	}

	// 延迟加载非关键资源
	document.addEventListener('DOMContentLoaded', function () {
		// 加载Bootstrap
		loadScript('js/bootstrap.bundle.min.js', function() {
			// 加载诗词API
			loadScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js', function() {
				jinrishici.load(function(result) {
					document.getElementById('jinrishici-sentence').innerHTML = result.data.content;
				});
			});
			
			// 加载导航数据
			fetch('js/nav-data.json')
				.then(response => response.json())
				.then(data => {
					renderNavigation(data.index);
					loadVersionInfo(data);
				})
				.catch(error => {
					console.error('加载导航数据时出错:', error);
					document.getElementById('nav-tabs-container').innerHTML = '<div class="alert alert-info">暂无导航数据，请先上传JSON文件</div>';
					document.getElementById('uptime1').textContent = 'Beta:error';
					document.getElementById('state1').textContent = 'Error';
				});
		});
	});

	function renderNavigation(navData) {
		const navTabsContainer = document.getElementById('nav-tabs-container');
		const navContentContainer = document.getElementById('nav-content-container');
		navTabsContainer.innerHTML = '';
		navContentContainer.innerHTML = '';

		// 渲染主要标签页
		navData.tabs.forEach((tab, index) => {
			const tabElement = document.createElement('a');
			tabElement.className = `nav-link btn nav-top ${index === 0 ? 'active' : ''}`;
			tabElement.textContent = tab.name;
			tabElement.setAttribute('data-tab', tab.name.toLowerCase().replace(/\s+/g, '-'));
			tabElement.href = '#';
			tabElement.addEventListener('click', function (e) {
				e.preventDefault();
				switchTab(tab.name.toLowerCase().replace(/\s+/g, '-'));
			});
			navTabsContainer.appendChild(tabElement);

			const contentElement = document.createElement('div');
			contentElement.className = `nav-ban ${index === 0 ? '' : 'd-none'}`;
			contentElement.id = `tab-${tab.name.toLowerCase().replace(/\s+/g, '-')}`;
			const row = document.createElement('div');
			row.className = 'row row-cols-4 p-2';
			tab.items.forEach(item => {
				// 修改这里：使用与more页面相同的图标逻辑
				const iconUrl = item.icon || `https://api.afmax.cn/so/ico/index.php?r=${encodeURIComponent(item.url)}`;
				const col = document.createElement('a');
				col.href = item.url;
				col.rel = 'nofollow';
				col.target = '_blank';
				col.className = 'col my-2 p-1 text-center text-black-50 kuaijie-a';
				col.innerHTML = `
					<img class="border rounded-circle w" src="${iconUrl}" loading="lazy" onerror="this.src='img/index.png'">
					<h6 class="t1">${item.name}</h6>`;
				row.appendChild(col);
			});
			contentElement.appendChild(row);
			navContentContainer.appendChild(contentElement);
		});

		// 在最后添加More链接
		const moreTabElement = document.createElement('a');
		moreTabElement.className = 'nav-link btn nav-top';
		moreTabElement.href = 'index/More.html';
		moreTabElement.textContent = '...';
		navTabsContainer.appendChild(moreTabElement);
	}

	function switchTab(tabName) {
		document.querySelectorAll('.nav-ban').forEach(tab => {
			tab.classList.add('d-none');
		});
		document.querySelectorAll('.nav-top').forEach(tab => {
			tab.classList.remove('active');
		});
		document.getElementById(`tab-${tabName}`).classList.remove('d-none');
		document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
	}
</script>
	<div class="z-1">
		<div class="z-4">
			<div id="jsi-flying-fish-container" class="w-100"></div>
			<script src="js/fish.js"></script>
		</div>
		<canvas class="background"></canvas>
	</div>
	<script src="js/particles.min.js"></script>
	<script src="js/foot.js"></script>
    
    <!-- 网络延迟检测脚本 -->
    <script>
        // 初始化延迟检测功能
        document.addEventListener('DOMContentLoaded', function() {
            const latencyBtn = document.getElementById('latencyBtn');
            const latencyPanel = document.getElementById('latencyPanel');
            const closeLatencyPanel = document.getElementById('closeLatencyPanel');
            const refreshLatency = document.getElementById('refreshLatency');
            
            // 打开/关闭延迟检测面板
            latencyBtn.addEventListener('click', function() {
                latencyPanel.classList.toggle('translate-x-full');
                if (!latencyPanel.classList.contains('translate-x-full')) {
                    // 面板打开时进行检测
                    testNetworkLatency();
                }
            });
            
            closeLatencyPanel.addEventListener('click', function() {
                latencyPanel.classList.add('translate-x-full');
            });
            
            refreshLatency.addEventListener('click', function() {
                testNetworkLatency();
            });
            
            // 测试网络延迟函数
            function testNetworkLatency() {
                // 测试服务器延迟（使用当前网站作为测试点）
                testLatency(window.location.origin + '/favicon.ico', 'server');
                
                // 测试Google延迟
                testLatency('https://www.google.com/favicon.ico', 'google');
            }
            
            // 单个延迟测试函数
            function testLatency(url, type) {
                const startTime = performance.now();
                const img = new Image();
                let timeout;
                
                // 设置超时处理
                timeout = setTimeout(function() {
                    updateLatencyDisplay(type, -1, '超时');
                }, 5000); // 5秒超时
                
                img.onload = function() {
                    clearTimeout(timeout);
                    const latency = performance.now() - startTime;
                    updateLatencyDisplay(type, latency);
                };
                
                img.onerror = function() {
                    clearTimeout(timeout);
                    updateLatencyDisplay(type, -1, '无法连接');
                };
                
                // 添加随机参数防止缓存
                img.src = url + '?t=' + Date.now();
            }
            
            // 更新延迟显示
            function updateLatencyDisplay(type, latency, status) {
                const latencyElement = document.getElementById(type + 'Latency');
                const barElement = document.getElementById(type + 'LatencyBar');
                const statusElement = document.getElementById(type + 'Status');
                
                if (latency === -1) {
                    latencyElement.textContent = 'N/A';
                    latencyElement.className = 'text-sm font-bold text-red-500';
                    barElement.style.width = '100%';
                    barElement.className = 'bg-red-500 h-1.5 rounded-full';
                    statusElement.textContent = '状态: ' + status;
                    return;
                }
                
                // 格式化延迟显示
                let latencyText = latency.toFixed(0) + 'ms';
                latencyElement.textContent = latencyText;
                
                // 设置延迟条宽度和颜色
                let width = Math.min(latency, 500) / 5;
                width = Math.max(1, width); // 至少显示1%
                barElement.style.width = width + '%';
                
                // 根据延迟设置颜色
                if (latency < 100) {
                    latencyElement.className = 'text-sm font-bold text-green-500';
                    barElement.className = 'bg-green-500 h-1.5 rounded-full';
                } else if (latency < 200) {
                    latencyElement.className = 'text-sm font-bold text-yellow-500';
                    barElement.className = 'bg-yellow-500 h-1.5 rounded-full';
                } else if (latency < 500) {
                    latencyElement.className = 'text-sm font-bold text-orange-500';
                    barElement.className = 'bg-orange-500 h-1.5 rounded-full';
                } else {
                    latencyElement.className = 'text-sm font-bold text-red-500';
                    barElement.className = 'bg-red-500 h-1.5 rounded-full';
                }
                
                // 更新状态
                if (latency < 100) {
                    statusElement.textContent = '状态: 优秀';
                } else if (latency < 200) {
                    statusElement.textContent = '状态: 良好';
                } else if (latency < 500) {
                    statusElement.textContent = '状态: 一般';
                } else {
                    statusElement.textContent = '状态: 较差';
                }
            }
        });
    </script>
	<script>
		//首页栏目切换算法
		var aTop = document.getElementsByClassName('nav-top');
		var aBan = document.getElementsByClassName('nav-ban');
		var i = 0;
		for (i = 0; i < aTop.length - 1; i++) {
			aTop[i].index = i;
			aTop[i].onmouseenter = function () {
				for (i = 0; i < aBan.length; i++) {
					aTop[i].className = 'nav-link btn nav-top';
					aBan[i].style.display = 'none';
				};
				aBan[this.index].style.display = 'block';
				this.className = 'nav-link btn nav-top active';
			};
		};

		//--------------------------------------------------------------

		//首页搜索框跳转指向算法
		var indexing = document.getElementById("indexing");
		var oMoreB = localStorage.getItem("oMoreB");

		//浏览器缓存不存在情况
		if (oMoreB == undefined) {
			oMoreB = 3;
			console.log("没有检查到缓存oMoreB");
		} else {
			oMoreB = parseInt(oMoreB);
			console.log("检查到缓存oMoreB=" + oMoreB);
		};

		if (oMoreB == 0) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae315f6.jpg");
		} else if (oMoreB == 1) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae315f6.jpg");
		} else if (oMoreB == 2) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae315f6.jpg");
		} else if (oMoreB == 3) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae316a3.gif");
		} else if (oMoreB == 4) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae31849.webp");
		} else if (oMoreB == 5) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f59871b83018ae31580.gif");
		} else if (oMoreB == 6) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e501d871b83018ae61acb.webp");
		} else if (oMoreB == 7) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae317c6.gif");
		} else if (oMoreB == 8) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e501d871b83018ae61a59.png");
		};

		//--------------------------------------------------------------

		//加载错误图片替换
		$('img').on("error", function () {
			$(this).attr('src', 'img/index.png');  // 替换为默认图片
		});

		//--------------------------------------------------------------

		//剪贴板内容跳转百度搜索
		function getClipboardText() {
			return new Promise((resolve, reject) => {
				navigator.clipboard.readText().then(text => {
					resolve(text);
				}).catch(err => {
					reject(err);
				});
			});
		}

		getClipboardText().then(text => {
			window.open("https://www.baidu.com/s?word=" + text, "_self");
		}).catch(err => {
			console.error('获取剪贴板文本失败：', err);
		});
	</script>
	<div style="display: none;">111</div>
</body>
</html>