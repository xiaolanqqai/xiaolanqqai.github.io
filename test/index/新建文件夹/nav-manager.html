<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>导航数据管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6a11cb;
            --secondary-color: #2575fc;
            --light-bg: #f8f9fa;
            --border-color: #dee2e6;
        }
        
        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 10px 10px;
        }
        
        .container-main {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            background-color: #f1f3f5;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            padding: 1rem 1.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a0db8 0%, #1c67e3 100%);
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            font-weight: 600;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .site-item {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .site-item:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .action-buttons .btn {
            margin-left: 5px;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(106, 17, 203, 0.25);
        }
        
        .footer {
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 2rem;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ced4da;
        }
        
        .preview-img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }
        
        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1.5rem;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: #e9ecef;
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }
        
        .json-preview {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.9rem;
        }
        
        .feature-card {
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .page-selector {
            background-color: #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .page-btn {
            margin: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1 class="text-center">导航数据管理系统</h1>
            <p class="text-center">管理您的网站导航选项卡内容</p>
        </div>
    </div>

    <div class="container container-main">
        <!-- 页面选择器 -->
        <div class="page-selector">
            <h5 class="mb-3">选择要管理的页面:</h5>
            <div class="d-flex flex-wrap">
                <button class="btn btn-outline-primary page-btn active" data-page="index">主页 (index.html)</button>
                <button class="btn btn-outline-primary page-btn" data-page="more-ai">更多页面 (More.html)</button>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center">
                        <div class="text-primary mb-3">
                            <i class="fas fa-file-upload fa-3x"></i>
                        </div>
                        <h5>上传JSON文件</h5>
                        <p>从您的设备上传导航数据JSON文件</p>
                        <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#uploadModal">
                            <i class="fas fa-upload me-1"></i>上传JSON
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center">
                        <div class="text-success mb-3">
                            <i class="fas fa-database fa-3x"></i>
                        </div>
                        <h5>从本地加载</h5>
                        <p>从浏览器本地存储加载之前保存的数据</p>
                        <button id="loadFromLocalBtn" class="btn btn-success mt-2">
                            <i class="fas fa-download me-1"></i>从本地加载
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card feature-card h-100">
                    <div class="card-body text-center">
                        <div class="text-info mb-3">
                            <i class="fas fa-save fa-3x"></i>
                        </div>
                        <h5>保存数据</h5>
                        <p>将当前数据保存到本地存储并下载JSON文件</p>
                        <button id="saveBtn" class="btn btn-info mt-2">
                            <i class="fas fa-save me-1"></i>保存数据
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span id="currentPageTitle">主页 - 导航选项卡管理</span>
                        <div>
                            <button id="addTabBtn" class="btn btn-sm btn-outline-secondary ms-1">
                                <i class="fas fa-plus me-1"></i>添加选项卡
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <strong>使用说明：</strong> 您可以在此页面管理导航选项卡和其中的网站链接。修改后请点击"保存数据"按钮。
                        </div>
                        
                        <ul class="nav nav-tabs mb-4" id="navTabs" role="tablist">
                            <!-- 选项卡将由JavaScript动态生成 -->
                        </ul>
                        
                        <div class="tab-content" id="navTabContent">
                            <!-- 选项卡内容将由JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <p>导航数据管理系统 &copy; 2023 Xiaolan</p>
            <p><a href="index.html" class="text-decoration-none">返回主页</a></p>
        </div>
    </div>

    <!-- 上传JSON模态框 -->
    <div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">上传JSON文件</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="upload-area" id="dropArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h5>拖放JSON文件到这里</h5>
                        <p class="text-muted">或者</p>
                        <label for="jsonFile" class="btn btn-primary">
                            <i class="fas fa-folder-open me-1"></i>选择文件
                        </label>
                        <input type="file" id="jsonFile" accept=".json" class="d-none">
                        <div class="mt-3">
                            <small class="text-muted">支持标准的JSON格式文件</small>
                        </div>
                    </div>
                    
                    <div id="fileInfo" class="d-none">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            <span id="fileName">已选择文件：</span>
                        </div>
                        
                        <h6 class="mt-4">JSON预览：</h6>
                        <div class="json-preview" id="jsonPreview">
                            {/* 预览内容将在这里显示 */}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirmUpload" disabled>确认上传</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加网站模态框 -->
    <div class="modal fade" id="addSiteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">添加新网站</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addSiteForm">
                        <div class="mb-3">
                            <label for="siteName" class="form-label">网站名称</label>
                            <input type="text" class="form-control" id="siteName" required>
                        </div>
                        <div class="mb-3">
                            <label for="siteUrl" class="form-label">网站地址</label>
                            <input type="url" class="form-control" id="siteUrl" required>
                        </div>
                        <div class="mb-3">
                            <label for="siteIcon" class="form-label">图标地址</label>
                            <input type="url" class="form-control" id="siteIcon" required>
                            <div class="form-text">可以使用: https://api.afmax.cn/so/ico/index.php?r=网站地址</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirmAddSite">添加</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加选项卡模态框 -->
    <div class="modal fade" id="addTabModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">添加新选项卡</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addTabForm">
                        <div class="mb-3">
                            <label for="tabName" class="form-label">选项卡名称</label>
                            <input type="text" class="form-control" id="tabName" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirmAddTab">添加</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 全局变量
        let navData = {};
        let currentTabIndex = 0;
        let currentPage = 'index';
        
        // DOM元素
        const navTabs = document.getElementById('navTabs');
        const navTabContent = document.getElementById('navTabContent');
        const saveBtn = document.getElementById('saveBtn');
        const addTabBtn = document.getElementById('addTabBtn');
        const loadFromLocalBtn = document.getElementById('loadFromLocalBtn');
        const pageTitle = document.getElementById('currentPageTitle');
        const pageButtons = document.querySelectorAll('.page-btn');
        const addSiteModal = new bootstrap.Modal(document.getElementById('addSiteModal'));
        const addTabModal = new bootstrap.Modal(document.getElementById('addTabModal'));
        const uploadModal = new bootstrap.Modal(document.getElementById('uploadModal'));
        const confirmAddSite = document.getElementById('confirmAddSite');
        const confirmAddTab = document.getElementById('confirmAddTab');
        const confirmUpload = document.getElementById('confirmUpload');
        const jsonFileInput = document.getElementById('jsonFile');
        const dropArea = document.getElementById('dropArea');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const jsonPreview = document.getElementById('jsonPreview');
        
        // 默认导航数据
        const defaultNavData = {
            "index": {
                "tabs": [
                    {
                        "name": "Home",
                        "items": [
                            {
                                "name": "Bilibili",
                                "url": "https://www.bilibili.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://www.bilibili.com"
                            },
                            {
                                "name": "樱花动漫",
                                "url": "https://www.dmh8.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://www.dmh8.com"
                            },
                            {
                                "name": "腾讯视频",
                                "url": "https://v.qq.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://v.qq.com"
                            },
                            {
                                "name": "爱奇艺",
                                "url": "https://www.iqiyi.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://www.iqiyi.com"
                            },
                            {
                                "name": "淘宝",
                                "url": "https://www.taobao.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://www.taobao.com"
                            },
                            {
                                "name": "京东",
                                "url": "https://www.jd.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://www.jd.com"
                            },
                            {
                                "name": "简书",
                                "url": "https://www.jianshu.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://www.jianshu.com"
                            }
                        ]
                    },
                    {
                        "name": "Tools",
                        "items": [
                            {
                                "name": "Google翻译",
                                "url": "https://translate.google.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://translate.google.com"
                            },
                            {
                                "name": "PDF转换器",
                                "url": "https://smallpdf.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://smallpdf.com"
                            }
                        ]
                    }
                ]
            },
            "more-ai": {
                "tabs": [
                    {
                        "name": "平台",
                        "items": [
                            {
                                "name": "淘宝",
                                "url": "https://www.taobao.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://www.taobao.com"
                            },
                            {
                                "name": "京东",
                                "url": "https://www.jd.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://www.jd.com"
                            },
                            {
                                "name": "百度网盘",
                                "url": "https://pan.baidu.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://pan.baidu.com"
                            },
                            {
                                "name": "163邮箱",
                                "url": "https://mail.163.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://mail.163.com"
                            }
                        ]
                    },
                    {
                        "name": "技术平台",
                        "items": [
                            {
                                "name": "阿里云",
                                "url": "https://www.aliyun.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://www.aliyun.com"
                            },
                            {
                                "name": "万网主机管理控制台",
                                "url": "https://cp.aliyun.com",
                                "icon": "https://api.afmax.cn/so/ico/index.php?r=https://cp.aliyun.com"
                            }
                        ]
                    }
                ]
            }
        };

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 尝试从本地存储加载数据
            const localData = localStorage.getItem('navData');
            if (localData) {
                try {
                    navData = JSON.parse(localData);
                    renderTabs();
                } catch (e) {
                    console.error('解析本地数据失败:', e);
                    loadDefaultData();
                }
            } else {
                loadDefaultData();
            }
            
            setupEventListeners();
        });
        
        // 设置事件监听器
        function setupEventListeners() {
            saveBtn.addEventListener('click', saveNavData);
            addTabBtn.addEventListener('click', showAddTabModal);
            loadFromLocalBtn.addEventListener('click', loadFromLocalStorage);
            confirmAddSite.addEventListener('click', addNewSite);
            confirmAddTab.addEventListener('click', addNewTab);
            confirmUpload.addEventListener('click', processUploadedFile);
            
            // 页面切换按钮事件
            pageButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 移除所有活动状态
                    pageButtons.forEach(b => b.classList.remove('active'));
                    // 设置当前按钮为活动状态
                    this.classList.add('active');
                    
                    // 切换页面
                    currentPage = this.getAttribute('data-page');
                    
                    // 更新页面标题
                    if (currentPage === 'index') {
                        pageTitle.textContent = '主页 - 导航选项卡管理';
                    } else if (currentPage === 'more-ai') {
                        pageTitle.textContent = '更多页面 - 导航选项卡管理';
                    }
                    
                    // 渲染当前页面的选项卡
                    renderTabs();
                });
            });
            
            // 文件上传相关事件
            jsonFileInput.addEventListener('change', handleFileSelect);
            
            // 拖放事件
            dropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                dropArea.style.borderColor = '#6a11cb';
                dropArea.style.backgroundColor = '#e9ecef';
            });
            
            dropArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                e.stopPropagation();
                dropArea.style.borderColor = '#dee2e6';
                dropArea.style.backgroundColor = '#f8f9fa';
            });
            
            dropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                dropArea.style.borderColor = '#dee2e6';
                dropArea.style.backgroundColor = '#f8f9fa';
                
                const files = e.dataTransfer.files;
                if (files.length && files[0].type === 'application/json') {
                    jsonFileInput.files = files;
                    handleFileSelect(e);
                } else {
                    alert('请拖放有效的JSON文件');
                }
            });
        }
        
        // 加载默认数据
        function loadDefaultData() {
            navData = JSON.parse(JSON.stringify(defaultNavData));
            renderTabs();
        }
        
        // 从本地存储加载数据
        function loadFromLocalStorage() {
            const localData = localStorage.getItem('navData');
            if (localData) {
                try {
                    navData = JSON.parse(localData);
                    renderTabs();
                    showAlert('数据已从本地存储加载', 'success');
                } catch (e) {
                    console.error('解析本地数据失败:', e);
                    showAlert('加载本地数据失败', 'danger');
                }
            } else {
                showAlert('没有找到本地数据', 'warning');
            }
        }
        
        // 处理文件选择
        function handleFileSelect(event) {
            const file = jsonFileInput.files[0];
            if (!file) return;
            
            if (file.type !== 'application/json') {
                alert('请选择JSON文件');
                return;
            }
            
            fileName.textContent = `已选择文件：${file.name}`;
            fileInfo.classList.remove('d-none');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const jsonData = JSON.parse(content);
                    
                    // 验证JSON结构
                    if (!jsonData.index || !jsonData.index.tabs) {
                        throw new Error('无效的JSON结构：缺少index页面数据');
                    }
                    
                    // 显示预览
                    jsonPreview.textContent = JSON.stringify(jsonData, null, 2);
                    confirmUpload.disabled = false;
                    
                    // 存储上传的数据以备确认
                    window.uploadedData = jsonData;
                } catch (e) {
                    jsonPreview.textContent = `错误：${e.message}`;
                    confirmUpload.disabled = true;
                }
            };
            reader.readAsText(file);
        }
        
        // 处理上传的文件
        function processUploadedFile() {
            if (window.uploadedData) {
                navData = window.uploadedData;
                renderTabs();
                uploadModal.hide();
                showAlert('JSON文件已成功上传并加载', 'success');
                
                // 清理
                delete window.uploadedData;
                jsonFileInput.value = '';
                fileInfo.classList.add('d-none');
                confirmUpload.disabled = true;
            }
        }
        
        // 渲染选项卡
        function renderTabs() {
            navTabs.innerHTML = '';
            navTabContent.innerHTML = '';
            
            // 检查当前页面是否存在
            if (!navData[currentPage] || !navData[currentPage].tabs || navData[currentPage].tabs.length === 0) {
                navTabContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>${currentPage}页面中没有导航数据</p>
                        <button class="btn btn-primary mt-2" id="addFirstTab">
                            <i class="fas fa-plus me-1"></i>添加第一个选项卡
                        </button>
                    </div>
                `;
                
                document.getElementById('addFirstTab').addEventListener('click', showAddTabModal);
                return;
            }
            
            navData[currentPage].tabs.forEach((tab, index) => {
                // 创建选项卡导航
                const tabNav = document.createElement('li');
                tabNav.className = 'nav-item';
                tabNav.innerHTML = `
                    <a class="nav-link ${index === 0 ? 'active' : ''}" id="tab-${index}-nav" data-bs-toggle="tab" 
                       href="#tab-${index}" role="tab" aria-controls="tab-${index}" aria-selected="${index === 0 ? 'true' : 'false'}">
                       ${tab.name}
                    </a>
                `;
                navTabs.appendChild(tabNav);
                
                // 创建选项卡内容
                const tabContent = document.createElement('div');
                tabContent.className = `tab-pane fade ${index === 0 ? 'show active' : ''}`;
                tabContent.id = `tab-${index}`;
                tabContent.setAttribute('role', 'tabpanel');
                tabContent.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>${tab.name} 选项卡中的网站</h5>
                        <button class="btn btn-sm btn-primary add-site-btn" data-tab-index="${index}">
                            <i class="fas fa-plus me-1"></i>添加网站
                        </button>
                    </div>
                    <div class="sites-container" id="sites-container-${index}">
                        ${renderSites(tab.items, index)}
                    </div>
                `;
                navTabContent.appendChild(tabContent);
            });
            
            // 为添加网站按钮添加事件监听器
            document.querySelectorAll('.add-site-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    currentTabIndex = parseInt(this.getAttribute('data-tab-index'));
                    document.getElementById('addSiteForm').reset();
                    addSiteModal.show();
                });
            });
        }
        
        // 渲染网站列表
        function renderSites(sites, tabIndex) {
            if (!sites || sites.length === 0) {
                return `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>此选项卡中没有网站</p>
                    </div>
                `;
            }
            
            return sites.map((site, siteIndex) => `
                <div class="site-item" data-site-index="${siteIndex}">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <img src="${site.icon}" class="preview-img" alt="${site.name}" onerror="this.src='../img/index.png'">
                            <div>
                                <div class="fw-bold">${site.name}</div>
                                <div class="text-muted small">${site.url}</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-outline-primary edit-site" data-tab-index="${tabIndex}" data-site-index="${siteIndex}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-site" data-tab-index="${tabIndex}" data-site-index="${siteIndex}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // 显示添加选项卡模态框
        function showAddTabModal() {
            document.getElementById('addTabForm').reset();
            addTabModal.show();
        }
        
        // 添加新选项卡
        function addNewTab() {
            const tabName = document.getElementById('tabName').value.trim();
            
            if (!tabName) {
                alert('请输入选项卡名称');
                return;
            }
            
            // 确保当前页面数据结构存在
            if (!navData[currentPage]) {
                navData[currentPage] = { tabs: [] };
            }
            if (!navData[currentPage].tabs) {
                navData[currentPage].tabs = [];
            }
            
            navData[currentPage].tabs.push({
                name: tabName,
                items: []
            });
            
            addTabModal.hide();
            renderTabs();
            showAlert(`已添加选项卡: ${tabName}`, 'success');
        }
        
        // 添加新网站
        function addNewSite() {
            const siteName = document.getElementById('siteName').value.trim();
            const siteUrl = document.getElementById('siteUrl').value.trim();
            const siteIcon = document.getElementById('siteIcon').value.trim();
            
            if (!siteName || !siteUrl || !siteIcon) {
                alert('请填写所有字段');
                return;
            }
            
            if (!navData[currentPage].tabs[currentTabIndex].items) {
                navData[currentPage].tabs[currentTabIndex].items = [];
            }
            
            navData[currentPage].tabs[currentTabIndex].items.push({
                name: siteName,
                url: siteUrl,
                icon: siteIcon
            });
            
            addSiteModal.hide();
            renderTabs();
            showAlert(`已添加网站: ${siteName}`, 'success');
        }
        
        // 保存导航数据
        function saveNavData() {
            try {
                localStorage.setItem('navData', JSON.stringify(navData));
                
                // 创建下载链接
                const dataStr = JSON.stringify(navData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = 'nav-data.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showAlert('导航数据已保存到本地存储并准备好下载', 'success');
            } catch (e) {
                console.error('保存数据时出错:', e);
                showAlert('保存数据时出错', 'danger');
            }
        }
        
        // 显示提示消息
        function showAlert(message, type) {
            // 移除现有的提示
            const existingAlert = document.querySelector('.alert-floating');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // 创建新提示
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-floating position-fixed`;
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '1050';
            alert.style.minWidth = '300px';
            alert.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
            alert.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'danger' ? 'fa-exclamation-circle' : 'fa-info-circle'} me-2"></i>
                    <div>${message}</div>
                    <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            document.body.appendChild(alert);
            
            // 5秒后自动消失
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>