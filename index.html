<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Xiaolan</title>
	<!-- 模块化 Header 组件 -->
	<script src="js/components/header-component.js"></script>
	
	<!-- 异步加载JS -->
	<script src="js/jquery-3.5.1.min.js"></script>
	<script src="js/search_ajx.js"></script> <!-- 提前加载搜索逻辑 -->
	<script src="performance-config.js" defer></script>
</head>

<body class="main-content overflow-y-hidden">
	<div class="content-wrapper d-flex flex-column mx-auto">
		<div class="d-flex flex-column justify-content-end" style="height: 57vh;">
			<div class="mx-auto shadow mt-3 rounded-3"><img id="indexing" width="250" src="img/login.png" class="p-1">
			</div>
			<div class="mx-auto mt-3 pt-3">
				<!-- 模块化 SearchEngine 组件 -->
				<div id="search-engine-container"></div>
				<script src="js/components/search-component.js"></script>
			</div>
		</div>
		<div class="d-flex flex-column justify-content-center pb-5" style="flex: 1;">
			<nav class="p-2 mx-auto">
				<div class="nav nav-tabs shadow rounded-2 justify-content-center" id="nav-tabs-container">
					<!-- More链接将由JavaScript动态添加 -->
				</div>
			</nav>
			<div class="mx-auto mt-3 kuaijie" id="nav-content-container"></div>
		</div>
		<div class="fixed-bottom mx-1">
			<div class="container-fluid">
				<div class="float-start fw-light"><span id="jinrishici-sentence">正在加载今日诗词....</span></div>
				<div class="float-end">
					<span class="badge text-black-50">
						<a href="test/index.html" rel="nofollow" target="_blank">Ts</a> •
						<a href="https://xiaolanqqai-sturdy-journey-97xqj446r6wfpw6v.github.dev/" rel="nofollow" target="_blank">Dev</a> •
						<a id="uptime1" href="index/Develop.html">加载中...</a>
					</span>
					<span id="state1" class="badge text-bg-success">加载中...</span>
					<a><div class="spinner-grow spinner-grow-sm text-info" role="status"></div></a>
				</div>
			</div>
		</div>
	</div>
	<script>
	// 异步加载关键JS
	function loadScript(src, callback) {
		var script = document.createElement('script');
		script.src = src;
		script.onload = callback;
		document.head.appendChild(script);
	}

	// 延迟加载非关键资源
	document.addEventListener('DOMContentLoaded', function () {
		// 加载Bootstrap
		loadScript('js/bootstrap.bundle.min.js', function() {
			// 加载诗词API
			loadScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js', function() {
				jinrishici.load(function(result) {
					document.getElementById('jinrishici-sentence').innerHTML = result.data.content;
				});
			});
			
			// 加载导航数据
			fetch('data/nav-data.json')
				.then(response => response.json())
				.then(data => {
					renderNavigation(data.index);
					loadVersionInfo(data);
				})
				.catch(error => {
					console.error('加载导航数据时出错:', error);
					document.getElementById('nav-tabs-container').innerHTML = '<div class="alert alert-info">暂无导航数据，请先上传JSON文件</div>';
					document.getElementById('uptime1').textContent = 'Beta:error';
					document.getElementById('state1').textContent = 'Error';
				});
		});
	});

	function renderNavigation(navData) {
		const navTabsContainer = document.getElementById('nav-tabs-container');
		const navContentContainer = document.getElementById('nav-content-container');
		navTabsContainer.innerHTML = '';
		navContentContainer.innerHTML = '';

		// 渲染主要标签页
		navData.tabs.forEach((tab, index) => {
			const tabId = tab.name.toLowerCase().replace(/\s+/g, '-');
			const tabElement = document.createElement('a');
			tabElement.className = `nav-link btn nav-top ${index === 0 ? 'active' : ''}`;
			tabElement.textContent = tab.name;
			tabElement.setAttribute('data-tab', tabId);
			tabElement.href = '#';
			
			// 点击切换
			tabElement.addEventListener('click', function (e) {
				e.preventDefault();
				switchTab(tabId);
			});
			
			// 划过切换
			tabElement.addEventListener('mouseenter', function () {
				switchTab(tabId);
			});
			
			navTabsContainer.appendChild(tabElement);

			const contentElement = document.createElement('div');
			contentElement.className = `nav-ban ${index === 0 ? '' : 'd-none'}`;
			contentElement.style.display = index === 0 ? 'block' : 'none';
			contentElement.id = `tab-${tabId}`;
			
			const row = document.createElement('div');
			row.className = 'row row-cols-4 g-2 p-2'; // 使用Bootstrap Gutter
			
			tab.items.forEach(item => {
				const iconUrl = item.url ? `https://api.afmax.cn/so/ico/index.php?r=${encodeURIComponent(item.url)}` : 'img/index.png';
				const col = document.createElement('div');
				col.className = 'col';
				col.innerHTML = `
					<a href="${item.url}" rel="nofollow" target="_blank" class="nav-ban-item">
						<img class="nav-ban-icon" src="${iconUrl}" loading="lazy" onerror="this.src='img/index.png'">
						<h6 class="nav-ban-text">${item.name}</h6>
					</a>`;
				row.appendChild(col);
			});
			contentElement.appendChild(row);
			navContentContainer.appendChild(contentElement);
		});

		// 在最后添加More链接
		const moreTabElement = document.createElement('a');
		moreTabElement.className = 'nav-link btn nav-top';
		moreTabElement.href = 'index/More.html';
		moreTabElement.textContent = '...';
		navTabsContainer.appendChild(moreTabElement);
	}

	function switchTab(tabId) {
		// 隐藏所有内容
		const contents = document.querySelectorAll('.nav-ban');
		contents.forEach(tab => {
			tab.classList.add('d-none');
			tab.style.display = 'none'; // 强制隐藏
		});
		
		// 移除所有标签的激活状态
		const tabs = document.querySelectorAll('.nav-top');
		tabs.forEach(tab => tab.classList.remove('active'));
		
		// 显示当前内容并激活当前标签
		const targetContent = document.getElementById(`tab-${tabId}`);
		const targetTab = document.querySelector(`[data-tab="${tabId}"]`);
		
		if (targetContent) {
			targetContent.classList.remove('d-none');
			targetContent.style.display = 'block'; // 强制显示
		}
		if (targetTab) targetTab.classList.add('active');
	}
</script>
	<!-- 模块化 Background 组件 -->
	<script src="js/components/background-component.js"></script>
	
	<script>
		function handleKeyPress(event) {
			if (event.keyCode === 13) {
				event.preventDefault();
				const form = document.querySelector('#search-engine-container form');
				if (form) {
                    if (typeof submitFn === 'function') {
                        submitFn(form, event);
                    } else {
                        // Fallback
                        const btn = document.querySelector('.search-icon');
                        if (btn) btn.click();
                    }
                }
				return false;
			}
		}

		//--------------------------------------------------------------
		//首页搜索框跳转指向算法
		var indexing = document.getElementById("indexing");
		var oMoreB = localStorage.getItem("oMoreB");

		//浏览器缓存不存在情况
		if (oMoreB == undefined) {
			oMoreB = 3;
			console.log("没有检查到缓存oMoreB");
		} else {
			oMoreB = parseInt(oMoreB);
			console.log("检查到缓存oMoreB=" + oMoreB);
		};

		if (oMoreB == 0) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae315f6.jpg");
		} else if (oMoreB == 1) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae315f6.jpg");
		} else if (oMoreB == 2) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae315f6.jpg");
		} else if (oMoreB == 3) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae316a3.gif");
		} else if (oMoreB == 4) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae31849.webp");
		} else if (oMoreB == 5) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f59871b83018ae31580.gif");
		} else if (oMoreB == 6) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e501d871b83018ae61acb.webp");
		} else if (oMoreB == 7) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e4f5a871b83018ae317c6.gif");
		} else if (oMoreB == 8) {
			indexing.setAttribute("src", "https://pic.imgdb.cn/item/659e501d871b83018ae61a59.png");
		};

		//--------------------------------------------------------------

		//加载错误图片替换（使用原生JavaScript）
		document.addEventListener('DOMContentLoaded', function() {
			const images = document.querySelectorAll('img');
			images.forEach(img => {
				img.addEventListener('error', function() {
					this.src = 'img/index.png';  // 替换为默认图片
				});
			});
		});

	</script>
	

	
	<div class="d-none">111</div>

</body>
</html>