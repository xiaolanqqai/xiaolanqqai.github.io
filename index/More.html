<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Xiaolan - More</title>
	<!-- 模块化 Header 组件 -->
	<script src="../js/components/header-component.js"></script>
	
	<script type="text/javascript" src="../js/jquery-3.5.1.min.js"></script>
	<script type="text/javascript" src="../js/search_ajx.js"></script>
</head>

<body class="main-content">
	<header class="sticky-header">
		<div class="container-fluid header-nav-container px-4">
			<button onclick="window.location.href = '../index.html'" type="button" class="btn btn-info shadow fw-bold">返回</button>
			<button onclick="window.location.href = 'DD.html'" type="button" class="btn btn-info shadow fw-bold">DD</button>
			
			<form class="d-flex flex-grow-1 mx-2" role="search" onsubmit="event.preventDefault(); document.getElementById('btn').click();">
				<input id="txt" class="form-control shadow me-2" type="search" placeholder="Search" aria-label="Search"
					onkeypress="handleKeyPress(event)">
				<button id="btn" class="btn btn-outline-success shadow" type="button">Search</button>
			</form>
			
			<div class="d-flex gap-2 align-items-center">
				<button id="more-s" class="btn btn-info dropdown-toggle shadow" type="button">Baidu</button>
				<button id="more-c" class="btn btn-info shadow oh" type="button">清空</button>
				<div id="more-mm" class="d-none d-flex gap-2">
					<button class="btn btn-info shadow oh" onclick="window.location.href = 'MM-secure.html'" type="button">M-M</button>
					<button class="btn btn-info shadow oh" onclick="window.location.href = 'manager/nav-manager.html'" type="button">manager</button>
				</div>
			</div>
		</div>
	</header>

	<div class="content-wrapper">
		<div class="container-fluid mt-3 px-4">
			<div id="more-b" class="more-grid d-none mb-4">
				<div class="more-card"><a href="javascript:a(0)" class="nav-ban-item"><img class="nav-ban-icon" src="../img/luyou.png" loading="lazy"><h6 class="nav-ban-text">1.</h6></a></div>
				<div class="more-card"><a href="javascript:a(1)" class="nav-ban-item"><img class="nav-ban-icon" src="../img/luyou.png" loading="lazy"><h6 class="nav-ban-text">2.</h6></a></div>
				<div class="more-card"><a href="javascript:a(2)" class="nav-ban-item"><img class="nav-ban-icon" src="../img/luyou.png" loading="lazy"><h6 class="nav-ban-text">192168.</h6></a></div>
				<div class="more-card"><a href="javascript:a(3)" class="nav-ban-item"><img class="nav-ban-icon" src="https://api.iowen.cn/favicon/www.baidu.com.png" loading="lazy"><h6 class="nav-ban-text">Baidu</h6></a></div>
				<div class="more-card"><a href="javascript:a(4)" class="nav-ban-item"><img class="nav-ban-icon" src="https://api.iowen.cn/favicon/www.bing.com.png" loading="lazy"><h6 class="nav-ban-text">Bing</h6></a></div>
				<div class="more-card"><a href="javascript:a(5)" class="nav-ban-item"><img class="nav-ban-icon" src="https://api.iowen.cn/favicon/www.google.com.png" loading="lazy"><h6 class="nav-ban-text">Google.hk</h6></a></div>
				<div class="more-card"><a href="javascript:a(6)" class="nav-ban-item"><img class="nav-ban-icon" src="https://api.iowen.cn/favicon/www.Yandex.com.png" loading="lazy"><h6 class="nav-ban-text">Yandex</h6></a></div>
				<div class="more-card"><a href="javascript:a(7)" class="nav-ban-item"><img class="nav-ban-icon" src="https://api.iowen.cn/favicon/www.bilibili.com.png" loading="lazy"><h6 class="nav-ban-text">BiliBili</h6></a></div>
				<div class="more-card"><a href="javascript:a(8)" class="nav-ban-item"><img class="nav-ban-icon" src="https://api.iowen.cn/favicon/www.kuaidi100.com.png" loading="lazy"><h6 class="nav-ban-text">快递100</h6></a></div>
			</div>
			
			<div id="nav-content-container"></div>
			
			<div class="mt-4 d-none" id="aav">
				<div class="alert alert-secondary shadow" role="alert">小日本ポートエロ</div>
				<div id="ar21" class="more-grid"></div>
			</div>
		</div>
		<div class="fixed-bottom mx-1">
			<div class=" container-fluid">
				<div class="float-end">
					<span class="badge text-black-50"><a
							href="https://xiaolanqqai-sturdy-journey-97xqj446r6wfpw6v.github.dev/" rel="nofollow"
							target="_blank">Dev</a> • <a id="uptime1" href="Develop.html">加载中...</a></span>
					<span id="state1" class="badge text-bg-success">加载中...</span>
					<a><div class="spinner-grow spinner-grow-sm text-info" role="status"></div></a>
				</div>
			</div>
		</div>
	</div>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			fetch('../data/nav-data.json')
				.then(response => response.json())
				.then(data => {
					renderNavigation(data['more']);
					renderSpecialSection(data['more']);
					loadVersionInfo(data);
				})
				.catch(error => {
					console.error('加载导航数据时出错:', error);
					document.getElementById('nav-content-container').innerHTML = '<div class="alert alert-info mx-3">暂无导航数据，请先上传JSON文件</div>';
					document.getElementById('uptime1').textContent = 'Beta:error';
					document.getElementById('state1').textContent = 'Error';
				});
		});

		// 在renderNavigation函数中修改图标生成
		function renderNavigation(navData) {
			const navContentContainer = document.getElementById('nav-content-container');
			navContentContainer.innerHTML = '';

			if (!navData || !navData.tabs) {
				navContentContainer.innerHTML = '<div class="alert alert-info">暂无导航数据</div>';
				return;
			}

			navData.tabs.forEach((tab, index) => {
				const section = document.createElement('div');
				section.className = 'mb-4';
				section.innerHTML = `
					<div class="alert alert-secondary shadow mb-3" role="alert">${tab.name}</div>
					<div id="ar${index + 1}" class="more-grid">
					</div>
				`;
				navContentContainer.appendChild(section);

				const grid = section.querySelector(`#ar${index + 1}`);
				tab.items.forEach(item => {
					const col = document.createElement('div');
					col.className = 'more-card';
					const iconUrl = item.url ? `https://api.iowen.cn/favicon/${new URL(item.url).hostname}.png` : '../img/index.png';
					col.innerHTML = `
						<a href="${item.url}" rel="nofollow" target="_blank" class="nav-ban-item">
							<img class="nav-ban-icon" src="${iconUrl}" loading="lazy" onerror="this.src='../img/index.png'">
							<h6 class="nav-ban-text">${item.name}</h6>
						</a>`;
					grid.appendChild(col);
				});
			});
		}

		// 在renderSpecialSection函数中修改图标生成
		function renderSpecialSection(moreData) {
			const specialContainer = document.getElementById('ar21');

			if (!moreData || !moreData.special || !moreData.special.sites) {
				console.log('未找到特殊栏目数据');
				return;
			}

			const specialSites = moreData.special.sites;

			if (specialSites.length === 0) {
				specialContainer.innerHTML = '<div class="alert alert-info">暂无特殊栏目数据</div>';
				return;
			}

			// 渲染特殊栏目的网站
			specialContainer.innerHTML = specialSites.map(site => {
				const iconUrl = site.icon || `https://api.iowen.cn/favicon/${new URL(site.url).hostname}.png`;
				return `
					<div class="more-card">
						<a href="${site.url}" rel="nofollow" target="_blank" class="nav-ban-item">
							<img class="nav-ban-icon" src="${iconUrl}" loading="lazy" onerror="this.src='../img/index.png'">
							<h6 class="nav-ban-text">${site.name}</h6>
						</a>
					</div>
				`;
			}).join('');

			console.log('特殊栏目已渲染（隐藏状态），共', specialSites.length, '个网站');
		}
	</script>
	<!-- 模块化 Background 组件 -->
	<script src="../js/components/background-component.js"></script>
	
	<script>
		function handleKeyPress(event) {
			if (event.keyCode === 13) {
				event.preventDefault();
				document.getElementById('btn').click();
				return false;
			}
		}
		
		$('img').on("error", function () {
			$(this).attr('src', '../img/index.png');
		});
	</script>
	<script>
		//more的头部搜索框调用
		var oTxt = document.getElementById("txt");
		var oBtn = document.getElementById("btn");
		var oMoreS = document.getElementById("more-s");
		var oMoreC = document.getElementById("more-b");
		var oMoreB = localStorage.getItem("oMoreB");
		var oMoreCC = document.getElementById("more-c");

		//浏览器缓存不存在情况
		if (oMoreB == undefined) {
			oMoreB = 3;
			console.log("没有检查到缓存oMoreB");
		} else {
			oMoreB = parseInt(oMoreB);
			console.log("检查到缓存oMoreB=" + oMoreB);
		};

		//清除缓存
		oMoreCC.onclick = function () {
			localStorage.clear();//清除全部
			// localStorage.removeItem("oMoreB");只清除oMoreB
			oTxt.value = "";
			console.log("已清空缓存");
		};

		oMoreS.onclick = function () {
			if (oMoreC.classList.contains("d-none")) {
				oMoreC.classList.remove("d-none");
				window.scrollTo(0, 0);
			} else {
				oMoreC.classList.add("d-none");
			};
		};

		//头部搜索指向缓存加载
		function mots() {
			var ii = oMoreB;
			oMoreS.innerHTML = ["1.", "2.", "192168", "Baidu", "Bing", "Google.hk", "Yandex", "BiliBili", "快递100"][ii];
		};

		function a(i) {
			oMoreS.innerHTML = ["→1.", "→2.", "→192168", "→Baidu", "→Bing", "→Google.hk", "→Yandex", "→BiliBili", "→快递100"][i];
			oMoreB = i;
			localStorage.setItem("oMoreB", i);
		};

		oBtn.onclick = function () {
			var oValue = oTxt.value;
			if (oValue == "") {
				alert("???");
			} else if (oMoreB === 0) {
				//触发aa
				var aav = document.getElementById("aav");
				if (oValue === "001") {
					console.log("welcom to ポートエロ");
					aav.classList.remove("d-none");
					window.scrollTo(0, document.documentElement.scrollHeight);
					oTxt.value = "";
				} else if (oValue === "002") {
					window.open("aa.htm");
					oTxt.value = "";
				} else if (oValue === "mm") {
					localStorage.setItem("userName", "xiaolan");
					oTxt.value = "";
				} else {
					window.open("http://192.168.1." + oValue);
					oTxt.value = "";
				};
			} else if (oMoreB === 1) {
				window.open("http://192.168.2." + oValue);
				oTxt.value = "";
			} else if (oMoreB === 2) {
				window.open("http://192.168." + oValue);
				oTxt.value = "";
			} else if (oMoreB === 3) {
				window.open("https://www.baidu.com/s?wd=" + oValue);
				oTxt.value = "";
			} else if (oMoreB === 4) {
				window.open("https://www.bing.com/search?q=" + oValue);
				oTxt.value = "";
			} else if (oMoreB === 5) {
				window.open("https://www.google.com.hk/search?q=" + oValue);
				oTxt.value = "";
			} else if (oMoreB === 6) {
				window.open("https://yandex.com/search/?text=" + oValue);
				oTxt.value = "";
			} else if (oMoreB === 7) {
				window.open("https://search.bilibili.com/all?keyword=" + oValue);
				oTxt.value = "";
			} else if (oMoreB === 8) {
				window.open("https://www.kuaidi100.com/chaxun?com=&nu=" + oValue);
				oTxt.value = "";
			};

		};

		//控制mm的显示
		var localMM = localStorage.getItem("userName");
		var oMoreMM = document.getElementById("more-mm");

		if (localMM == "xiaolan") {
			oMoreMM.classList.remove("d-none");
		};
	</script>
	<script>
		function handleKeyPress(event) {
			if (event.keyCode === 13) {
				event.preventDefault();
				document.getElementById('btn').click();
				return false;
			}
		}
	</script>
	<script>mots()</script>

	<div class="d-none">111</div>
</body>

</html>